
"use strict"





var fs                   = require('fs')

var log                       = require('engram/logging/logger')
var Result               = require('engram/commons/result').Result
var Ok                   = require('engram/commons/result').Ok
var Err                  = require('engram/commons/result').Err

var createTLSCredentials = require('engram/security/create-tls-credentials')





var ensureTLSCredentialsExist = (args, callback) => {

	var ensureResult = Result.of(( ) => {

		var keypathExists  = fs.lstatSync(args.keypath) .isFile( )
		var certpathExists = fs.lstatSync(args.certpath).isFile( )

		return keypathExists && certpathExists

	})

	ensureResult.onOk(bothExist => {

		if (args.certs || !bothExist) {

			log.security.info({ }, 'creating missing tls credentials.')

			createTLSCredentials(args.keypath, args.certpath, createResult => {
				callback(createResult)
			})
		}

	})

	callback(ensureResult)

}





module.exports = ensureTLSCredentialsExist
