
"use strict"



var http                 = require('http')
var https                = require('https')
var express              = require('express')

var commons              = require('engram/commons/commons')
var createTables         = require('engram/persistance/create-tables')
var createTLSCredentials = require('engram/security/create-tls-credentials')
var loadTLSCredentials   = require('engram/security/load-tls-credentials')
var log                  = require('engram/logging/logger')
var attachRoutes         = require('engram/app/attach-routes')
var startApp             = require('engram/app/start-app')
var specs                = require('engram/rest/route-specs')

var addRoutes            = require('engram/rest/add-routes')




var createApp = (args, database, callback) => {

	var credentials = loadTLSCredentials(args.keypath, args.certpath)

	var apps = {
		https:  attachRoutes(express( ), addRoutes(specs))
	}

	var servers = {
		https: https.createServer(credentials, apps.https)
	}

	startApp(args, apps, servers, callback)

}




module.exports = createApp
