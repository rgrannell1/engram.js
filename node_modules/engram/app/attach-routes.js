
"use strict"





var is  = require('is')
var log = require('engram/logging/logger')





var compileRoute = (app, spec) => {

	compileRoute.precond(app, spec)

	var shouldRun = (req, res, next) => {
		next( )
	}

	var boilerplated = spec.fns.map(fn => {
		return function ( ) {

			var args = Array.prototype.slice.apply(arguments)

			createBoilerplate(spec)(args)
			fn.call({ }, args)

		}
	})

	app[spec.method]( spec.route, [shouldRun].concat(boilerplated) )

}

compileRoute.precond = (app, spec) => {

	is.always.object(spec)

	is.always.array(spec.fns)
	is.always.string(spec.route)
	is.always.string(spec.method)

}





var createBoilerplate = spec => {

	createBoilerplate.precond(spec)

}

createBoilerplate.precond = spec => {
	return function (args)	{

		log.global.info({ }, spec.route)

	}
}





var attachRoutes = (app, specs) => {

	app.specs = specs

	attachRoutes.precond(app, specs)

	specs.forEach(route => compileRoute(app, route))

	return app

}

attachRoutes.precond = (app, routes) => {
	is.always.array(routes)
}




module.exports = attachRoutes
