#!/usr/bin/env node
"use strict";

var log = require("engram/logger");

var is = require("is");
var Result = require("engram/result").Result;
var Ok = require("engram/result").Ok;
var Err = require("engram/result").Err;

var saveBookmark = require("engram/save-bookmark");
var createArchive = require("engram/create-archive");
var log = require("engram/logger");
var database = require("engram/database");

var request = require("request");

var resaveBookmark = function (bookmark) {

	is.always.object(bookmark);
	saveBookmark(decodeURIComponent(bookmark.url), bookmark.ctime);
};

var resaveBookmarks = function (body, req, res) {

	is.always.object(body);
	is.always.object(req);
	is.always.object(res);

	var bookmarksResult = Result.of(function () {
		return Object.keys(body.data).map(function (key) {
			return body.data[key];
		});
	});

	bookmarksResult.then(function (data) {
		return data.sort(function (bookmark0, bookmark1) {
			return bookmark0.ctime - bookmark1.ctime;
		});
	}).then(function (data) {
		console.log(data);
		data.forEach(resaveBookmark);
	});
};

module.exports = resaveBookmarks;