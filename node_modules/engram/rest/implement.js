"use strict"





var is      = require('is')
var commons = require('engram/commons/commons')



var applyPatch = (patch, onPatch, spec) => {

	if (spec.id !== patch.id) {
		return spec
	}

	var patched = { }

	Object.keys(spec).forEach(key => {
		patched[key] = spec[key]
	})

	Object.keys(patch).forEach(key => {

		patched[key] = is.function(patch[key])
			? patch[key]( spec[key] )
			: patch[key]

	})

	onPatch(patch, spec)

	return patched

}





var implement = (specs, patch, onPatch) => {

	implement.precond(specs, patch, onPatch)

	specs.routes = specs.routes.map(applyPatch.bind({ }, patch, onPatch))

	return specs

}

implement.precond = (specs, patch, onPatch) => {

	is.always.string(patch.id)
	is.always.function(onPatch)

}





module.exports = implement
