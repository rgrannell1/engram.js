#!/usr/bin/env node
"use strict";

var log = require("engram/logger");

var is = require("is");

var Result = require("engram/result").Result;
var Ok = require("engram/result").Ok;
var Err = require("engram/result").Err;

var routes = require("engram/routes");
var database = require("engram/database");

var sendArchive = function (res, rowResult) {

	rowResult.onErr(function (err) {

		res.send(500);
		res.send(err.message);
	});

	rowResult.onOk(function (_ref) {
		var content = _ref.content;
		var contentType = _ref.contentType;

		console.log(content);
		console.log(contentType);
	});
};

var fetchArchive = function (res, id) {

	fetchArchive.precond(id);

	var callback = sendArchive.bind({}, res);

	database.serialise(function (db) {

		var sql = "\n\t\tSELECT content, content_type\n\t\tFROM archive\n\t\tWHERE archive.url = $url\n\t\tLIMIT $limit\n\t\t";

		db.run(sql, {

			$url: url }, function (err) {
			callback(err ? Err(err) : Ok(url));
		});
	});
};

fetchArchive.precond = function (id) {
	is.always.number(id);
};

module.exports = fetchArchive;