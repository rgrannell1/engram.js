#!/usr/bin/env node
"use strict";

var log = require("engram/logger");

try {

	var is = require("is");
	var https = require("https");
	var express = require("express");
	var bunyan = require("bunyan");

	var routes = require("engram/routes");
} catch (err) {

	log.fatal({ err: err }, "failed to load dependencies.");
}

var create = function (_ref) {
	var port = _ref.port;

	var app = express();

	app.listen(port, function () {
		log.info("engram listening on port " + port);
	}).on("error", function (err) {

		var handled = {
			EADDRINUSE: "port " + port + " currently in use"
		};

		err.code in handled ? log.error(handled[err.code]) : log.error(err.toString());
	});

	app.use("/", routes.app).use("/api", routes.api);

	process.on("uncaughtException", function (err) {
		log.fatal({ err: err }, "uncaught exception");
	});
};

create({
	port: 5000
});
