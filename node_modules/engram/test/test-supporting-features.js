
"use strict"




var fs        = require('fs')
var assert    = require('assert')

var constants = require('./constants')
var commons   = require('./commons')
var server    = require('../app/start-server')
var mocha     = require('mocha')









describe('- supporting features', function ( ) {

	var testApps
	this.timeout(10000)

	before(done => {

		server(commons.defaultArgs({

			certpath: constants.TEST_CERTPATH,
			keypath:  constants.TEST_KEYPATH,
			certs:    true

		}), apps => {
			testApps = apps
			done( )
		})

	})

	describe('certs', ( ) => {

		for (var ith = 0; ith < 2; ++ith) {

			it(`generates certificates when asked (repetition ${ith})`, done => {

				var certExists = false
				var keyExists  = false

				try {

					certExists = fs.lstatSync(constants.TEST_CERTPATH).isFile( )
					keyExists  = fs.lstatSync(constants.TEST_KEYPATH).isFile( )

				} catch (err) {
					console.log(err)
				}

				assert(keyExists,  'key did not exist')
				assert(certExists, 'cert did not exist')

				done( )

			})

		}

	})

	after(done => {

		try {

			fs.unlinkSync(constants.TEST_CERTPATH)
			fs.unlinkSync(constants.TEST_KEYPATH)

		} catch (err) {
			console.log('failed to remove test credentials:' + err.message)
		}

		done( )

	})

})
