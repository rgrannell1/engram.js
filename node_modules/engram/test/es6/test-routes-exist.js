#!/usr/bin/env node



var path      = require('path')
var http      = require('http')
var should    = require('should')
var request   = require('request')

var utils     = require('./utils')






var assertExists = (callback, err, res, body) => {

	if (err) {
		throw err
	}

	if (!res || res.statusCode >= 400) {
		throw new Error(`failed to load route properly: ${res.statusCode}`)
	}

	setTimeout(callback, 250)
}






var routes = [
	'/',
	'/bookmarks',
	'/bookmarks/all'
]









var app

describe('/*', ( ) => {

	before(done => {

		app = utils.setupEngram(app)
		setTimeout(done, 1.8 * 1000)

	})

	routes.forEach(route => {

		it(`${route} should exist`, done => {
			request.get({

				url:                utils.at(route),
      			rejectUnauthorized: false

			}, assertExists.bind({ }, done))
		})

	})

	after(( ) => {

		app.http .close( )
		app.https.close( )

	})

})
