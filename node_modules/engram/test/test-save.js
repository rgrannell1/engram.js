#!/usr/bin/env node
"use strict";

var http = require("http");
var should = require("should");
var request = require("supertest");
var engram = require("engram/engram");

var app;

describe("/*", function () {

	before(function (done) {

		app = engram({
			port: 5000,
			database: ":memory"
		});

		setTimeout(done, 2000);
	});

	it("should 404 for non-http/https URLs", function () {

		request(app).get("/ftp://foo.bar").expect(404).end(function (err) {
			if (err) throw err;
		});

		request(app).get("/file://baz.bar").expect(404).end(function (err) {
			if (err) throw err;
		});
	});

	it("should 200 for http", function () {

		request(app).get("/http://google.com").expect(200).end(function (err) {
			if (err) throw err;
		});
	});

	it("should 200 for https", function () {

		request(app).get("/https://google.com").expect(200).end(function (err) {
			if (err) throw err;
		});
	});

	it("should 200 with query string", function () {

		request(app).get("/http://google.com?foo=bar&bash=baz").expect(200).end(function (err) {
			if (err) throw err;
		});

		request(app).get("/https://bar/baz/?foo=bar&bash=baz").expect(200).end(function (err) {
			if (err) throw err;
		});
	});

	it("should 200 without the protocol", function () {

		request(app).get("/www.google.com?foo=bar&bash=baz").expect(200).end(function (err) {
			if (err) throw err;
		});
	});
});