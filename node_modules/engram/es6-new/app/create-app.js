
"use strict"



var http                 = require('http')
var https                = require('https')
var express              = require('express')

var commons              = require('engram/es6-new/commons/commons')
var createTables         = require('engram/es6-new/persistance/create-tables')
var createTLSCredentials = require('engram/es6-new/security/create-tls-credentials')
var loadTLSCredentials   = require('engram/es6-new/security/load-tls-credentials')
var log                  = require('engram/es6-new/logging/logger')
var attachRoutes         = require('engram/es6-new/app/attach-routes')
var routes               = require('engram/es6-new/rest/routes')






var createApp = (args, database, callback) => {

	var credentials = loadTLSCredentials(args.keypath, args.certpath)

	var apps = {
		http:  http.createServer(express( )),
		https: https.createServer(credentials, express( ))
	}

	callback({
		http:  attachRoutes(apps.http,  routes.http),
		https: attachRoutes(apps.https, routes.https)
	})

}




module.exports = createApp
