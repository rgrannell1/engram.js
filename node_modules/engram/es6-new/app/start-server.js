#!/usr/bin/env node

"use strict"





var log                  = require('engram/es5/logging/logger')
var startApp             = require('engram/es5/logging/logger')
var createTLSCredentials = require('engram/es5/security/create-tls-credentials')




var callbacks = { }

callbacks.wipeData = wipeResult => {

	wipeResult.onOk(( ) => {
		log.global.info('successfully cleared database/logs.')
	})

	wipeResult.onErr(( ) => {
		log.global.info('failed to wipe database/logs.')
	})

}

callbacks.createTLSCredentials = createResult => {

	createResult.onErr(err => {
		log.global.error({err}, 'failed to create https certificates.')
	})

}





var server = rawArgs => {

	var args = server.processArgs(server.validateArgs(rawArgs))

	if (args.wipe) {

		if (args.database) {
			wipeData.database(callback)
		}

		if (args.logs) {
			wipeData.logs(callback)
		}

	} else if (args.cert) {
		createTLSCredentials(args.keypath, args.certpath, callbacks.createTLSCredentials)
	} else {
		return startApp(args)
	}

}

server.validateArgs = args => {
	return args
}

server.processArgs = args => {
	return args
}





module.exports = server
