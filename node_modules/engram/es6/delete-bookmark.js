#!/usr/bin/env node

"use strict"





var database  = require('engram/es6/database')
var constants = require('engram/es6/constants')





var deleteBookmark = (res, id) => {

	database.serialise(db => {

		var sql = 'DELETE FROM bookmark WHERE bookmarkId = ?'
		db.run(sql, id)

		removeUnreferencedURL(res, id)

	})

}





var removeUnreferencedURL = res =>{

	database.serialise(db => {

		var sql = `
		DELETE FROM url
		WHERE url NOT IN (SELECT url from bookmark);
		`

		db.run(sql)

		removeUnreferencedArchive(res)

	})

}




var removeUnreferencedArchive = res => {

	database.serialise(db => {

		var sql = `
		DELETE FROM archive
		WHERE url NOT IN (SELECT url from bookmark);
		`

		db.run(sql)

		res.status(204)
		res.end( )

	})

}





module.exports = deleteBookmark
