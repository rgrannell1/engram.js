#!/usr/bin/env node

"use strict"





var is        = require('is')
var log       = require('engram/es5/logger')

var Result    = require('engram/es5/result').Result
var Ok        = require('engram/es5/result').Ok
var Err       = require('engram/es5/result').Err

var database  = require('engram/es5/database')
var bookmark  = require('engram/es5/bookmark')
var constants = require('engram/es5/constants')





var deleteBookmark = (res, id) => {

	database.serialise(db => {

		var sql = 'DELETE FROM bookmark WHERE bookmarkId = ?'
		db.run(sql, id)

		removeUnreferencedURL(res, id)

	})

}





var removeUnreferencedURL = res =>{

	database.serialise(db => {

		var sql = `
		DELETE FROM url
		WHERE url NOT IN (SELECT url from bookmark);
		`

		db.run(sql)

		removeUnreferencedArchive(res)

	})

}




var removeUnreferencedArchive = res => {

	database.serialise(db => {

		var sql = `
		DELETE FROM archive
		WHERE url NOT IN (SELECT url from bookmark);
		`

		db.run(sql)

		res.status(204)
		res.end( )

	})

}





module.exports = deleteBookmark
