#!/usr/bin/env node

"use strict"





var is        = require('is')
var log       = require('engram/es5/logger')

var Result    = require('engram/es5/result').Result
var Ok        = require('engram/es5/result').Ok
var Err       = require('engram/es5/result').Err

var constants = require('engram/es5/constants')
var message   = require('engram/es5/message')





{
	let amount = 0
	let startTime
	let lastTime

	constants.BUS.on(message.URL_RESOLVED, saveResult => {

		if (is.undefined(startTime)) {
			startTime = new Date( ).getTime( )
		}

		lastTime = new Date( ).getTime( )
		++amount

		var rate = amount / ((lastTime - startTime) / 1000)

		if (isFinite(rate)) {
			log.stats.info({rate}, `current rate: ${rate}`)
		}


	})

}




{

	constants.BUS.on(message.URL_RESOLVED, urlResult => {

		let totalTime = 0
		let amount    = 0

		urlResult.onOk( ({res, body}) => {

			++amount
			totalTime += (req.requestTime || 0)

			var averageTime = totalTime / amount

			log.stats.info({averageTime}, `average request time: ${averageTime}`)

		})

	})

}
