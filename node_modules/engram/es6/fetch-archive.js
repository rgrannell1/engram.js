#!/usr/bin/env node

"use strict"





var log = require('engram/logger')

var is          = require('is')

var Result      = require('engram/result').Result
var Ok          = require('engram/result').Ok
var Err         = require('engram/result').Err


var routes      = require('engram/routes')
var database    = require('engram/database')










var sendArchive = (res, rowResult) => {

	rowResult.onErr(err => {

		res.send(500)
		res.send(err.message)

	})

	rowResult.onOk({content, contentType} => {

		console.log( content )
		console.log( contentType )

	})

}






var fetchArchive = (res, id) => {

	fetchArchive.precond(id)

	var callback = sendArchive.bind({ }, res)

	database.serialise(db => {

		var sql = `
		SELECT content, content_type
		FROM archive
		WHERE archive.url = $url
		LIMIT $limit
		`

		db.run(sql, {

			$url: url,

		}, err => {
			callback(err ? Err(err) : Ok(url))
		})

	})

}

fetchArchive.precond = id => {
	is.always.number(id)
}










module.exports = fetchArchive
