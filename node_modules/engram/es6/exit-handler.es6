#!/usr/bin/env node

"use strict"





var log = require('engram/logger')

try {

	var database = require('engram/database')

} catch (err) {

	log.fatal({
		message: err.message,
		stacK:   err.stack,
	}, 'failed to load dependencies.')

	process.exit( )

}





var exitHandler = (shouldExit, err) => {

	if (err) {

		log.fatal({
			message: err.message,
			stack:   err.stack
		}, `uncaught exception`)

	}


	if (shouldExit) {

		try {

			database.close( )

		} catch (err) {

			log.error({
				message: err.message,
				stack:   err.stack
			}, `failed to close database connection.`)

		}

		process.exit( )
	}

}




module.exports = exitHandler
