#!/usr/bin/env node

"use strict"





var log     = require('engram/logger')

var Result  = require('engram/result').Result
var Ok      = require('engram/result').Ok
var Err     = require('engram/result').Err

var sqlite3 = require("sqlite3").verbose()

var log     = require('engram/logger')
var path    = require('path')





var dbconn;

var database = {

	conn: ( ) => {

		if (!dbconn) {

			dbconn = new sqlite3.Database(
				DATABASE === ':memory:'
				? DATABASE
				: path.join(process.cwd( ), DATABASE))

		}

		return dbconn

	},

	do: (executor, callback) => {

		database.conn( ).serialize(( ) => {

			executor(database.conn( ), callback)

		})

	},

	close: ( ) => database.conn( ).close

}




module.exports = database
