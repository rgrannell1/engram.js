#!/usr/bin/env node

"use strict"





var log     = require('engram/es5/logger')

var Result  = require('engram/es5/result').Result
var Ok      = require('engram/es5/result').Ok
var Err     = require('engram/es5/result').Err

var sqlite3 = require("sqlite3").verbose()

var log     = require('engram/es5/logger')
var path    = require('path')





var dbconn





var database = {

	conn: ( ) => {

		var dbPath = DATABASE === ':memory:'
			? DATABASE
			: path.join(process.cwd( ), DATABASE)

		if (!dbconn) {

			dbconn = new sqlite3.Database(dbPath, err => {

				if (err) {

					log.global.fatal({message: err.message, stack: err.stack}, `failed to load database.`)
					throw err

					process.exit(1)

				}

			})

		}

		return dbconn

	},

	serialise: callback =>  {
		database.conn( ).serialize(( ) => {
			callback(database.conn( ))
		})
	},

	close: ( ) => database.conn( ).close

}




module.exports = database
