#!/usr/bin/env node

"use strict"





var log          = require('engram/logger')

var Result       = require('engram/result').Result
var Ok           = require('engram/result').Ok
var Err          = require('engram/result').Err

var URL          = require('url')

var database     = require('engram/database')
var extractTitle = require('engram/extract-title')
var requestURL   = require('engram/request-url')





var updateTitle = (url, title, callback) => {

	var sql = `UPDATE url SET title=$title WHERE url.url = $url`

	database.serialise(db => {

		db.run(sql, {
			$url:   url,
			$title: title
		}, err => {
			callback(err ? Err(err) : Ok(url))
		})

	})

}






var saveTitle = ({url, res, body}, reporter) => {

	extractTitle({url, res, body}, titleResult => {

		titleResult.onErr(err => {
			reporter(Err(err))
		})

		titleResult.onOk(title => {
			updateTitle(url, title, reporter)
		})

	})

}





module.exports = saveTitle
