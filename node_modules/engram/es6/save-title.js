#!/usr/bin/env node

"use strict"





var Ok           = require('engram/es5/result').Ok
var Err          = require('engram/es5/result').Err

var database     = require('engram/es5/database')
var extractTitle = require('engram/es5/extract-title')





var updateTitle = (url, title, callback) => {

	var sql = `UPDATE url SET title=$title WHERE url.url = $url`

	database.serialise(db => {

		db.run(sql, {
			$url:   url,
			$title: title
		}, err => {
			callback(err ? Err(err) : Ok(url))
		})

	})

}






var saveTitle = ({url, res, body}, reporter) => {

	extractTitle({url, res, body}, titleResult => {

		titleResult.onErr(err => {
			reporter(Err(err))
		})

		titleResult.onOk(title => {
			updateTitle(url, title, reporter)
		})

	})

}





module.exports = saveTitle
