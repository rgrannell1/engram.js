#!/usr/bin/env node

"use strict"





var log           = require('engram/logger')

var is            = require('is')
var Result        = require('engram/result').Result
var Ok            = require('engram/result').Ok
var Err           = require('engram/result').Err

var saveBookmark  = require('engram/save-bookmark')
var createArchive = require('engram/create-archive')
var log           = require('engram/logger')
var database      = require('engram/database')
var constants     = require('engram/constants')


var request       = require('request')





var publishURL = bookmark => {

	constants.BUS.fire(':url', {
		url:  decodeURIComponent(bookmark.url),
		time: bookmark.ctime || Math.round(new Date( ).getTime( ) / 1000)
	})

}





var importBookmarks = (body, req, res) => {

	is.always.object(body)
	is.always.object(req)
	is.always.object(res)

	// -- cast the object to an array.
	var bookmarksResult = Result.of(( ) => {

		return Object.keys(body.data)
			.filter(number => {
				return parseInt(number, 10) === parseInt(number, 10)
			})
			.map(key => body.data[key])

	})

	bookmarksResult
	.then(data => {

		return data
		.sort((bookmark0, bookmark1) => {
			return bookmark0.ctime - bookmark1.ctime
		})

	})
	.then(urls => {
		urls.forEach(publishURL)
	})

}





module.exports = importBookmarks
