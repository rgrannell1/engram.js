#!/usr/bin/env node

"use strict"





var log = require('engram/logger')

try {

	var is      = require('is')
	var https   = require('https')
	var express = require('express')
	var bunyan  = require('bunyan')

	var routes  = require('engram/routes')

} catch (err) {

	log.fatal({err}, 'failed to load dependencies.')

}





var create = ({port}) => {

	var app = express( )

	app
	.listen(port, ( ) => {
		log.info(`engram listening on port ${port}`)
	})
	.on('error', err => {

		var handled = {
			EADDRINUSE: `port ${port} currently in use`
		}

		err.code in handled
			? log.error(handled[err.code])
			: log.error(err.toString( ))

	})

	app
	.use('/',    routes.app)
	.use('/api', routes.api)

	process.on('uncaughtException', err => {
		log.fatal({err}, `uncaught exception`)
	})

}





create({
	port: 5000
})