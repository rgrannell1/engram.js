#!/usr/bin/env node

"use strict"





var log           = require('engram/logger')

var is            = require('is')
var Result        = require('engram/result').Result
var Ok            = require('engram/result').Ok
var Err           = require('engram/result').Err

var saveBookmark  = require('engram/save-bookmark')
var createArchive = require('engram/create-archive')
var log           = require('engram/logger')
var database      = require('engram/database')

var request       = require('request')





var resaveBookmark = bookmark => {

	is.always.object(bookmark)
	saveBookmark(decodeURIComponent(bookmark.url), bookmark.ctime)
}

var resaveBookmarks = (body, req, res) => {

	is.always.object(body)
	is.always.object(req)
	is.always.object(res)

	var bookmarksResult = Result.of(( ) => {
		return Object.keys(body.data).map(key => body.data[key]);
	})

	bookmarksResult
	.then(data => {
		return data
		.sort((bookmark0, bookmark1) => {
			return bookmark0.ctime - bookmark1.ctime
		})
	})
	.then(data => {
		console.log(data)
		data.forEach(resaveBookmark)
	})

}





module.exports = resaveBookmarks
