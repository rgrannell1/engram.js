#!/usr/bin/env node

"use strict"





var log               = require('engram/es5/logging/logger')

var is                = require('is')
var fs                = require('fs')
var path              = require('path')

var Result            = require('engram/es5/result').Result
var Ok                = require('engram/es5/result').Ok





var wipeData = function (args, callback) {

	wipeData.precond(args, callback)

	if (args.logs) {

		wipeData.logs(args, callback)

	} else if (args.db) {

		wipeData.database(args, callback)

	}

}

wipeData.precond = (args) => {

	is.always.object(args)

}





wipeData.logs = (args, callback) => {

	log.global.info(`erasing all logs.`)

	var logPath    = 'log'

	var wipeResult =
		Ok(logPath)
		.then(fs.readdirSync)
		.then(filenames => {
			filenames.forEach(file => fs.unlinkSync(path.join(logPath, file)) )
		})

	callback(wipeResult)

}

wipeData.database = (args, callback) => {

	log.global.info(`erasing all database entries and tables.`)

	var databasePath = 'data'
	var toKeep       = ['data-bookmarks.json', 'ip-whitelist']

	var wipeResult   =
		Ok(databasePath)
		.then(fs.readdirSync)
		.then(files => {
			return files.filter(fname => toKeep.indexOf(fname) === -1)
		})
		.then(files =>
			files.forEach(
				file => fs.unlinkSync(path.join(databasePath, file)))
		)

	callback(wipeResult)

}





module.exports = wipeData
