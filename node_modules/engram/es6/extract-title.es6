#!/usr/bin/env node

"use strict"





var Result   = require('engram/result').Result
var Ok       = require('engram/result').Ok
var Err      = require('engram/result').Err

var mimetype = require('engram/mimetype')

var phantom  = require('phantom')
var $        = require('cheerio')





var headers = {
	headers: {
		'User-Agent': 'Mozilla/5.0 (Windows NT 6.0) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31'
	}
}



var extractResourceName = uri => {

}

var getDomainName = uri => {

}

var chooseBestTitle = (url, titles) => {

}




var processPage = (ph, status) => {

	if (status !== 'success') {
		extractTitle.html.js(url, res, callback)
	}

}





var extractTitle = (url, {body, res}, callback) => {

	var contentType = res.headers['content-type']
	var parsed      = mimetype.parse(contentType)

	if (mimetype.isHTML(parsed)) {
		extractTitle.html.phantom(url, res, callback)
	}

	if (mimetype.isPDF(parsed)) {
		extractTitle.pdf(url, res, callback)
	}

}

extractTitle.html = (url, res) => , callback{
	extractTitle.html.phantom(url, res, callback)
}






extractTitle.html.js = (url, res) => , callback{

}

extractTitle.html.phantom = (url, res) => , callback{

	phantom.create(ph => {
		ph.createPage(page => {
			page.open(url, headers, processPage.bind({ }, ph))
		})
	})

	page.onResourceError = err => {
		extractTitle.html.js(url, res, callback)
	}

}

extractTitle.pdf = (url, res) => , callback{

}





module.exports = extractTitle
