#!/usr/bin/env node

"use strict"





var Result        = require('engram/result').Result
var Ok            = require('engram/result').Ok
var Err           = require('engram/result').Err

var extractTitle  = require('engram/extract-title')
var createArchive = require('engram/create-archive')

var request       = require('request')





var requestUrl = (url, callback) => {

	var opts  = {
		url,
		headers: {
			'User-Agent': 'Mozilla/5.0 (Windows NT 6.0) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31'
		}
	}

	request(opts, (err, res, body) => {

		if (err) {
			callback(Err(err.message))
		} else {
			callback( Ok({res, body}) )
		}

	})

}





var saveTitle = (url, time, content) => {

	extractTitle(url, content, title => {
		console.log( title )
	})

}

var saveArchive = (url, content) => {

}





var saveBookmark = (url, time, {req, res}) => {

	requestUrl(url, contentResult => {

		contentResult.then(saveTitle.bind({ },   url, time))
		contentResult.then(saveArchive.bind({ }, url))

	})

}





module.exports = saveBookmark
