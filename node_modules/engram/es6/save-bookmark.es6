#!/usr/bin/env node

"use strict"





var log = require('engram/logger')

try {

	var extractTitle  = require('engram/extract-title')
	var createArchive = require('engram/create-archive')
	var log           = require('engram/logger')

	var request       = require('request')

} catch (err) {

	log.fatal({err}, 'failed to load dependencies.')

}





var requestUrl = (url, callback) => {

	var opts  = {
		url,
		headers: {
			'User-Agent': 'Mozilla/5.0 (Windows NT 6.0) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31'
		}
	}

	request(opts, (err, res, body) => {

		if (err) {

			log.error({url, err}, 'url lookup failed.')
			callback(Err(err.message))

		} else {

			log.info({url}, 'url lookup succeeded.')
			callback( Ok({res, body}) )

		}

	})

}





var insertBookmark = (url, time, title) => {

}




var saveTitle = (url, time, content) => {
	extractTitle(url, content, insertBookmark.bind({ }, url, time))
}

var saveArchive = (url, content) => {

}





var saveBookmark = (url, time, {req, res}) => {

	requestUrl(url, contentResult => {

		contentResult.then(saveTitle.bind({ },   url, time))
		contentResult.then(saveArchive.bind({ }, url))

	})

}





module.exports = saveBookmark
