#!/usr/bin/env node


"use strict";

var database = require('engram/es5/database');
var constants = require('engram/es5/constants');

var deleteBookmark = function deleteBookmark(res, id) {

	database.serialise(function (db) {

		var sql = 'DELETE FROM bookmark WHERE bookmarkId = ?';
		db.run(sql, id);

		removeUnreferencedURL(res, id);
	});
};

var removeUnreferencedURL = function removeUnreferencedURL(res) {

	database.serialise(function (db) {

		var sql = '\n\t\tDELETE FROM url\n\t\tWHERE url NOT IN (SELECT url from bookmark);\n\t\t';

		db.run(sql);

		removeUnreferencedArchive(res);
	});
};

var removeUnreferencedArchive = function removeUnreferencedArchive(res) {

	database.serialise(function (db) {

		var sql = '\n\t\tDELETE FROM archive\n\t\tWHERE url NOT IN (SELECT url from bookmark);\n\t\t';

		db.run(sql);

		res.status(204);
		res.end();
	});
};

module.exports = deleteBookmark;
