#!/usr/bin/env node
"use strict";

var log = require("engram/es5/logger");

var sqlite3 = require("sqlite3").verbose();

var log = require("engram/es5/logger");
var path = require("path");

var dbconn;

var database = {

	conn: function () {

		var dbPath = DATABASE === ":memory:" ? DATABASE : path.join(process.cwd(), DATABASE);

		if (!dbconn) {

			dbconn = new sqlite3.Database(dbPath, function (err) {

				if (err) {

					log.global.fatal({ message: err.message, stack: err.stack }, "failed to load database.");
					throw err;

					process.exit(1);
				}
			});
		}

		return dbconn;
	},

	serialise: function (callback) {
		database.conn().serialize(function () {
			callback(database.conn());
		});
	},

	close: function () {
		return database.conn().close;
	}

};

module.exports = database;