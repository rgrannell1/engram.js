#!/usr/bin/env node


"use strict";

var Ok = require('engram/es5/result').Ok;
var Err = require('engram/es5/result').Err;

var database = require('engram/es5/database');
var extractTitle = require('engram/es5/extract-title');

var updateTitle = function updateTitle(url, title, callback) {

	var sql = 'UPDATE url SET title=$title WHERE url.url = $url';

	database.serialise(function (db) {

		db.run(sql, {
			$url: url,
			$title: title
		}, function (err) {
			callback(err ? Err(err) : Ok(url));
		});
	});
};

var saveTitle = function saveTitle(_ref, reporter) {
	var url = _ref.url;
	var res = _ref.res;
	var body = _ref.body;

	extractTitle({ url: url, res: res, body: body }, function (titleResult) {

		titleResult.onErr(function (err) {
			reporter(Err(err));
		});

		titleResult.onOk(function (title) {
			updateTitle(url, title, reporter);
		});
	});
};

module.exports = saveTitle;
