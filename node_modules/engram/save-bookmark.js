#!/usr/bin/env node
"use strict";

var Result = require("engram/result").Result;
var Ok = require("engram/result").Ok;
var Err = require("engram/result").Err;

var extractTitle = require("engram/extract-title");
var createArchive = require("engram/create-archive");

var request = require("request");

var requestUrl = function (url, callback) {

	var opts = {
		url: url,
		headers: {
			"User-Agent": "Mozilla/5.0 (Windows NT 6.0) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31"
		}
	};

	request(opts, function (err, res, body) {

		if (err) {
			callback(Err(err.message));
		} else {
			callback(Ok({ res: res, body: body }));
		}
	});
};

var insertBookmark = function (x) {
	console.log(x);
};

var insertArchive = function (x) {
	console.log(x);
};

var saveBookmark = function (url, time, _ref) {
	var req = _ref.req;
	var res = _ref.res;

	Ok(url).then(function (url) {

		requestUrl(url, function (contentResult) {

			contentResult.then(createArchive).then(insertArchive);
			contentResult.then(extractTitle).then(insertBookmark);
		});
	});
};

module.exports = saveBookmark;
