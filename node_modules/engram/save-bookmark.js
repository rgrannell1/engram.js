#!/usr/bin/env node
"use strict";

var Result = require("engram/result").Result;
var Ok = require("engram/result").Ok;
var Err = require("engram/result").Err;

var extractTitle = require("engram/extract-title");
var createArchive = require("engram/create-archive");
var log = require("engram/logger");

var request = require("request");

var requestUrl = function (url, callback) {

	var opts = {
		url: url,
		headers: {
			"User-Agent": "Mozilla/5.0 (Windows NT 6.0) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31"
		}
	};

	request(opts, function (err, res, body) {

		if (err) {

			log.error({ url: url, err: err }, "url lookup failed.");
			callback(Err(err.message));
		} else {

			log.info({ url: url }, "url lookup succeeded.");
			callback(Ok({ res: res, body: body }));
		}
	});
};

var saveTitle = function (url, time, content) {

	extractTitle(url, content, function (title) {

		console.log("++ ++ ++ ++");
		console.log(title);
	});
};

var saveArchive = function (url, content) {};

var saveBookmark = function (url, time, _ref) {
	var req = _ref.req;
	var res = _ref.res;

	requestUrl(url, function (contentResult) {

		contentResult.then(saveTitle.bind({}, url, time));
		contentResult.then(saveArchive.bind({}, url));
	});
};

module.exports = saveBookmark;
