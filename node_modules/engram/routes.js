#!/usr/bin/env node
"use strict";

var Result = require("engram/result").Result;
var Ok = require("engram/result").Ok;
var Err = require("engram/result").Err;

var express = require("express");
var saveBookmark = require("engram/save-bookmark");
var log = require("engram/logger");

var api = express.Router();
var app = express.Router();

var parseURL = function (url) {
	return url // -- TODO STUB
	;
};

app.get("/*", function (req, res) {

	var pathResult = Ok(req).then(function (req) {
		return req.url;
	}).then(function (url) {
		return url.slice(1);
	}).then(parseURL);

	pathResult.onOk(function (path) {

		log.info("GET " + path);

		saveBookmark(path, new Date().getTime(), { req: req, res: res });

		res.status(204);
		res.end();
	});

	pathResult.onErr(function (path) {

		res.status(204);
		res.end();
	});
});

module.exports = {
	api: api,
	app: app
};
