#!/usr/bin/env node
"use strict";

var log = require("engram/logger");

var is = require("is");

var Result = require("engram/result").Result;
var Ok = require("engram/result").Ok;
var Err = require("engram/result").Err;

var database = require("engram/database");
var bookmark = require("engram/bookmark");

var deleteBookmark = function (res, id) {

	database["do"](function (db, callback) {

		var sql = "DELETE FROM bookmark WHERE bookmark_id = ?";
		db.run(sql, id);

		callback();
	}, removeUnreferenced.bind({}, res));
};

var removeUnreferenced = function (res) {

	database["do"](function (db, callback) {

		var sql = "\n\t\tDELETE FROM url\n\t\tWHERE url NOT IN (SELECT url from bookmark);\n\t\t";

		db.run(sql);

		callback();
	}, function () {

		res.status(204);
		res.end();
	});
};

module.exports = deleteBookmark;